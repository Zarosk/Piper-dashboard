<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aircraft Production Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .dashboard-header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 300;
        }
        
        .dashboard-header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #6f42c1, #5a2d91);
        }
        
        .btn-small {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            margin: 2px;
        }
        
        .btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
        }
        
        .btn-small.btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .btn-small.btn-danger:hover {
            box-shadow: 0 2px 8px rgba(220,53,69,0.3);
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid;
        }
        
        .card-operational { border-left-color: #28a745; }
        .card-maintenance { border-left-color: #ffc107; }
        .card-grounded { border-left-color: #dc3545; }
        .card-inspection { border-left-color: #17a2b8; }
        .card-total { border-left-color: #6c757d; }
        
        .card-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .card-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-control {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .main-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            min-width: 1300px;
        }
        
        th {
            background: linear-gradient(135deg, #343a40, #495057);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 11px;
        }
        
        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-select {
            border: none;
            background: transparent;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            width: 130px;
        }
        
        .status-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,.25);
        }
        
        .status-select.production-ready {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-select.in-progress {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-select.on-hold {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-select.quality-check {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .priority-select {
            border: none;
            background: transparent;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            width: 80px;
        }
        
        .priority-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,.25);
        }
        
        .priority-select.critical {
            background-color: #dc3545;
            color: white;
        }
        
        .priority-select.high {
            background-color: #fd7e14;
            color: white;
        }
        
        .priority-select.medium {
            background-color: #ffc107;
            color: #000;
        }
        
        .priority-select.low {
            background-color: #28a745;
            color: white;
        }
        
        .table-input {
            border: none;
            background: transparent;
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 4px;
            width: 100%;
        }
        
        .table-input:hover {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .table-input:focus {
            outline: none;
            background-color: white;
            border: 2px solid #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .notes-input {
            border: none;
            background: transparent;
            font-size: 11px;
            color: #666;
            padding: 2px 4px;
            border-radius: 3px;
            width: 100%;
            min-height: 40px;
            resize: vertical;
            font-family: inherit;
        }
        
        .notes-input:hover {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
        }
        
        .notes-input:focus {
            outline: none;
            background-color: white;
            border: 2px solid #007bff;
            box-shadow: 0 0 0 0.1rem rgba(0,123,255,.15);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .operation-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            transform: scale(1.2);
        }
        
        .operation-cell {
            text-align: center;
            padding: 8px;
        }
        
        .row-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .select-all-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-right: 8px;
        }
        
        .selected-row {
            background-color: #e3f2fd !important;
        }
        
        .selected-count {
            font-weight: bold;
            color: #6f42c1;
        }
        
        .hidden-row {
            display: none;
        }
        
        .drag-handle {
            cursor: grab;
            color: #6c757d;
            padding: 4px;
            margin-right: 8px;
            user-select: none;
            font-size: 14px;
            transition: color 0.2s ease;
        }
        
        .drag-handle:hover {
            color: #007bff;
            cursor: grab;
        }
        
        .drag-handle:active {
            cursor: grabbing;
            color: #0056b3;
        }
        
        tr[draggable="true"]:hover .drag-handle {
            color: #007bff;
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
            background-color: #e3f2fd !important;
        }
        
        .drag-over {
            border-top: 3px solid #007bff !important;
        }
        
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            padding: 8px 0;
            z-index: 1000;
            min-width: 180px;
            display: none;
        }
        
        .context-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .context-menu-item:hover {
            background-color: #f8f9fa;
        }
        
        .context-menu-item.danger:hover {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .context-menu-divider {
            height: 1px;
            background-color: #e9ecef;
            margin: 4px 0;
        }
        
        .shortcuts-help {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1001;
            display: none;
            max-width: 250px;
        }
        
        .shortcuts-help h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .shortcut-key {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 24px;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <h1>Aircraft Production Dashboard</h1>
        <p>Real-time production monitoring and build status overview</p>
    </div>
    
    <div class="section">
        <h3>Bulk Operations</h3>
        <div style="margin-bottom: 15px;">
            <span class="selected-count" id="selected-count">0</span> aircraft selected
        </div>
        <div class="controls-grid">
            <button class="btn btn-purple" onclick="bulkUpdateStatus()" disabled>Update Status</button>
            <button class="btn btn-purple" onclick="bulkUpdatePriority()" disabled>Update Priority</button>
            <button class="btn btn-purple" onclick="bulkUpdateTeam()" disabled>Assign Team</button>
            <button class="btn btn-purple" onclick="copySelectedAircraft()" disabled>Copy Aircraft</button>
        </div>
    </div>
    
    <div class="section">
        <h3>Search & Filter Aircraft</h3>
        <div class="controls-grid">
            <input type="text" id="search-input" class="form-control" placeholder="🔍 Search by Aircraft ID or Model">
            <select id="status-filter" class="form-control">
                <option value="">All Statuses</option>
                <option value="Production Ready">Production Ready</option>
                <option value="In Progress">In Progress</option>
                <option value="On Hold">On Hold</option>
                <option value="Quality Check">Quality Check</option>
            </select>
            <input type="text" id="team-filter" class="form-control" placeholder="Filter by Team">
            <select id="priority-filter" class="form-control">
                <option value="">All Priorities</option>
                <option value="Critical">Critical</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
        </div>
        <button onclick="clearFilters()" class="btn">Clear All Filters</button>
    </div>
    
    <div class="section">
        <h3>Add New Aircraft</h3>
        <button class="btn" onclick="addNewAircraft()">➕ Add Aircraft</button>
        <p style="margin-top: 10px; font-size: 12px; color: #666;">
            Click to add a new aircraft row to the dashboard
        </p>
    </div>
    
    <div class="section">
        <h3>Export Dashboard Data</h3>
        <button class="btn btn-info" onclick="exportToCSV()">📊 Download CSV</button>
        <button class="btn btn-success" onclick="copyTableData()">📋 Copy for Excel/Sheets</button>
        <button class="btn btn-purple" onclick="generatePDFReport()">📄 Generate PDF Report</button>
        <p style="margin-top: 10px; font-size: 12px; color: #666;">
            CSV: Raw data export • Copy: Paste into Excel/Google Sheets • PDF: Professional summary report
        </p>
    </div>
    
    <div class="section">
        <h3>Data Management</h3>
        <button class="btn btn-success" onclick="exportBackup()">💾 Download Backup</button>
        <button class="btn btn-success" onclick="importBackup()">📥 Import Backup</button>
        <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
        <p style="margin-top: 10px; font-size: 12px; color: #666;">
            Backup: Save/restore your data • Auto-saves every 30 seconds
        </p>
    </div>
    
    <div class="summary-cards">
        <div class="summary-card card-operational">
            <div class="card-number" style="color: #28a745;" id="prod-ready-count">2</div>
            <div class="card-label">Production Ready</div>
        </div>
        <div class="summary-card card-maintenance">
            <div class="card-number" style="color: #ffc107;" id="in-progress-count">1</div>
            <div class="card-label">In Progress</div>
        </div>
        <div class="summary-card card-grounded">
            <div class="card-number" style="color: #dc3545;" id="on-hold-count">1</div>
            <div class="card-label">On Hold</div>
        </div>
        <div class="summary-card card-inspection">
            <div class="card-number" style="color: #17a2b8;" id="quality-check-count">1</div>
            <div class="card-label">Quality Check</div>
        </div>
        <div class="summary-card card-total">
            <div class="card-number" style="color: #6c757d;" id="total-count">5</div>
            <div class="card-label">Total Units</div>
        </div>
    </div>
    
    <div class="main-table">
        <table>
            <thead>
                <tr>
                    <th><span class="drag-handle">⋮⋮</span><input type="checkbox" id="select-all" class="select-all-checkbox" /> Select</th>
                    <th>Aircraft ID</th>
                    <th>Model</th>
                    <th>Status</th>
                    <th>Operation 10</th>
                    <th>Operation 20</th>
                    <th>Operation 30</th>
                    <th>Operation 40</th>
                    <th>Operation 50</th>
                    <th>Progress</th>
                    <th>Priority</th>
                    <th>Pre-Flight Notes</th>
                    <th>Pre-Cert Notes</th>
                    <th>NCMR Notes</th>
                    <th>Delivery Date</th>
                    <th>Team</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="aircraft-tbody">
                <tr draggable="true">
                    <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                    <td><input type="text" class="table-input" placeholder="AC-001" /></td>
                    <td>
                        <select class="table-input">
                            <option value="">Select Model</option>
                            <option value="PA-28-181">PA-28-181</option>
                            <option value="PA-28-181 DX">PA-28-181 DX</option>
                            <option value="PA-44-180">PA-44-180</option>
                            <option value="PA-46-350P">PA-46-350P</option>
                            <option value="PA-46-500">PA-46-500</option>
                            <option value="PA-46-700">PA-46-700</option>
                        </select>
                    </td>
                    <td>
                        <select class="status-select production-ready">
                            <option value="Production Ready" selected>Production Ready</option>
                            <option value="In Progress">In Progress</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Quality Check">Quality Check</option>
                        </select>
                    </td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </td>
                    <td>
                        <select class="priority-select medium">
                            <option value="Critical">Critical</option>
                            <option value="High">High</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </td>
                    <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                    <td><input type="date" class="table-input" /></td>
                    <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                    <td>
                        <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                        <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                    </td>
                </tr>
                <tr draggable="true">
                    <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                    <td><input type="text" class="table-input" placeholder="AC-002" /></td>
                    <td>
                        <select class="table-input">
                            <option value="">Select Model</option>
                            <option value="PA-28-181">PA-28-181</option>
                            <option value="PA-28-181 DX">PA-28-181 DX</option>
                            <option value="PA-44-180">PA-44-180</option>
                            <option value="PA-46-350P">PA-46-350P</option>
                            <option value="PA-46-500">PA-46-500</option>
                            <option value="PA-46-700">PA-46-700</option>
                        </select>
                    </td>
                    <td>
                        <select class="status-select in-progress">
                            <option value="Production Ready">Production Ready</option>
                            <option value="In Progress" selected>In Progress</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Quality Check">Quality Check</option>
                        </select>
                    </td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </td>
                    <td>
                        <select class="priority-select medium">
                            <option value="Critical">Critical</option>
                            <option value="High">High</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </td>
                    <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                    <td><input type="date" class="table-input" /></td>
                    <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                    <td>
                        <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                        <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                    </td>
                </tr>
                <tr draggable="true">
                    <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                    <td><input type="text" class="table-input" placeholder="AC-003" /></td>
                    <td>
                        <select class="table-input">
                            <option value="">Select Model</option>
                            <option value="PA-28-181">PA-28-181</option>
                            <option value="PA-28-181 DX">PA-28-181 DX</option>
                            <option value="PA-44-180">PA-44-180</option>
                            <option value="PA-46-350P">PA-46-350P</option>
                            <option value="PA-46-500">PA-46-500</option>
                            <option value="PA-46-700">PA-46-700</option>
                        </select>
                    </td>
                    <td>
                        <select class="status-select production-ready">
                            <option value="Production Ready" selected>Production Ready</option>
                            <option value="In Progress">In Progress</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Quality Check">Quality Check</option>
                        </select>
                    </td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </td>
                    <td>
                        <select class="priority-select high">
                            <option value="Critical">Critical</option>
                            <option value="High" selected>High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </td>
                    <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                    <td><input type="date" class="table-input" /></td>
                    <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                    <td>
                        <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                        <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                    </td>
                </tr>
                <tr draggable="true">
                    <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                    <td><input type="text" class="table-input" placeholder="AC-004" /></td>
                    <td>
                        <select class="table-input">
                            <option value="">Select Model</option>
                            <option value="PA-28-181">PA-28-181</option>
                            <option value="PA-28-181 DX">PA-28-181 DX</option>
                            <option value="PA-44-180">PA-44-180</option>
                            <option value="PA-46-350P">PA-46-350P</option>
                            <option value="PA-46-500">PA-46-500</option>
                            <option value="PA-46-700">PA-46-700</option>
                        </select>
                    </td>
                    <td>
                        <select class="status-select quality-check">
                            <option value="Production Ready">Production Ready</option>
                            <option value="In Progress">In Progress</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Quality Check" selected>Quality Check</option>
                        </select>
                    </td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </td>
                    <td>
                        <select class="priority-select low">
                            <option value="Critical">Critical</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low" selected>Low</option>
                        </select>
                    </td>
                    <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                    <td><input type="date" class="table-input" /></td>
                    <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                    <td>
                        <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                        <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                    </td>
                </tr>
                <tr draggable="true">
                    <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                    <td><input type="text" class="table-input" placeholder="AC-005" /></td>
                    <td>
                        <select class="table-input">
                            <option value="">Select Model</option>
                            <option value="PA-28-181">PA-28-181</option>
                            <option value="PA-28-181 DX">PA-28-181 DX</option>
                            <option value="PA-44-180">PA-44-180</option>
                            <option value="PA-46-350P">PA-46-350P</option>
                            <option value="PA-46-500">PA-46-500</option>
                            <option value="PA-46-700">PA-46-700</option>
                        </select>
                    </td>
                    <td>
                        <select class="status-select on-hold">
                            <option value="Production Ready">Production Ready</option>
                            <option value="In Progress">In Progress</option>
                            <option value="On Hold" selected>On Hold</option>
                            <option value="Quality Check">Quality Check</option>
                        </select>
                    </td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </td>
                    <td>
                        <select class="priority-select critical">
                            <option value="Critical" selected>Critical</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </td>
                    <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                    <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                    <td><input type="date" class="table-input" /></td>
                    <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                    <td>
                        <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                        <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="last-updated" id="last-updated">
        Dashboard Last Updated: Loading...
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu">
        <button class="context-menu-item" onclick="contextEditAircraft()">
            ✏️ Edit Aircraft
        </button>
        <button class="context-menu-item" onclick="contextCopyAircraft()">
            📋 Copy Aircraft
        </button>
        <button class="context-menu-item" onclick="contextChangeStatus()">
            🔄 Change Status
        </button>
        <button class="context-menu-item" onclick="contextChangePriority()">
            ⚡ Change Priority
        </button>
        <div class="context-menu-divider"></div>
        <button class="context-menu-item" onclick="contextSelectRow()">
            ☑️ Select Row
        </button>
        <button class="context-menu-item danger" onclick="contextDeleteAircraft()">
            🗑️ Delete Aircraft
        </button>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div id="shortcuts-help" class="shortcuts-help">
        <h4>⌨️ Keyboard Shortcuts</h4>
        <div class="shortcut-item">
            <span>Select All</span>
            <span class="shortcut-key">Ctrl+A</span>
        </div>
        <div class="shortcut-item">
            <span>Delete Selected</span>
            <span class="shortcut-key">Delete</span>
        </div>
        <div class="shortcut-item">
            <span>New Aircraft</span>
            <span class="shortcut-key">Ctrl+N</span>
        </div>
        <div class="shortcut-item">
            <span>Clear Selection</span>
            <span class="shortcut-key">Escape</span>
        </div>
        <div class="shortcut-item">
            <span>Show Help</span>
            <span class="shortcut-key">F1</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Global variables
        let currentContextRow = null;
        let draggedRow = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            loadDataFromStorage();
            updateSummaryCards();
            
            // Auto-save every 30 seconds
            setInterval(saveDataToStorage, 30000);
            
            // Save when leaving page
            window.addEventListener('beforeunload', saveDataToStorage);
        });

        function initializeDashboard() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                addEventListenersToRow(row);
                setupDragAndDrop(row);
            });
        }

        function setupEventListeners() {
            // Search and filter
            document.getElementById('search-input').addEventListener('input', searchAndFilter);
            document.getElementById('status-filter').addEventListener('change', searchAndFilter);
            document.getElementById('team-filter').addEventListener('input', searchAndFilter);
            document.getElementById('priority-filter').addEventListener('change', searchAndFilter);
            
            // Select all checkbox
            document.getElementById('select-all').addEventListener('change', toggleSelectAll);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Context menu
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#context-menu')) {
                    hideContextMenu();
                }
            });
            
            // Right-click context menu for rows
            document.querySelectorAll('tbody tr').forEach(row => {
                row.addEventListener('contextmenu', function(e) {
                    showContextMenu(e, this);
                    return false;
                });
            });
        }

        // Export functions
        function exportToCSV() {
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tr');
            let csvContent = '';
            
            rows.forEach(row => {
                const cols = row.querySelectorAll('th, td');
                const rowData = [];
                
                cols.forEach((col, index) => {
                    if (index === 0) return; // Skip drag handle column
                    
                    let cellText = '';
                    const input = col.querySelector('input');
                    const select = col.querySelector('select');
                    const textarea = col.querySelector('textarea');
                    
                    if (input && input.type !== 'checkbox') {
                        cellText = input.value;
                    } else if (select) {
                        cellText = select.value;
                    } else if (textarea) {
                        cellText = textarea.value;
                    } else if (input && input.type === 'checkbox') {
                        cellText = input.checked ? 'Yes' : 'No';
                    } else {
                        cellText = col.textContent.trim();
                    }
                    
                    cellText = cellText.replace(/\s+/g, ' ');
                    if (cellText.includes(',') || cellText.includes('"')) {
                        cellText = '"' + cellText.replace(/"/g, '""') + '"';
                    }
                    rowData.push(cellText);
                });
                
                csvContent += rowData.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'aircraft_production_dashboard_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function copyTableData() {
            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tr');
            let tableText = '';
            
            rows.forEach(row => {
                const cols = row.querySelectorAll('th, td');
                const rowData = [];
                
                cols.forEach((col, index) => {
                    if (index === 0) return; // Skip drag handle column
                    
                    let cellText = '';
                    const input = col.querySelector('input');
                    const select = col.querySelector('select');
                    const textarea = col.querySelector('textarea');
                    
                    if (input && input.type !== 'checkbox') {
                        cellText = input.value;
                    } else if (select) {
                        cellText = select.value;
                    } else if (textarea) {
                        cellText = textarea.value;
                    } else if (input && input.type === 'checkbox') {
                        cellText = input.checked ? 'Yes' : 'No';
                    } else {
                        cellText = col.textContent.trim();
                    }
                    
                    cellText = cellText.replace(/\s+/g, ' ');
                    rowData.push(cellText);
                });
                
                tableText += rowData.join('\t') + '\n';
            });
            
            navigator.clipboard.writeText(tableText).then(() => {
                alert('✅ Table data copied to clipboard! You can now paste it into Excel or Google Sheets.');
            }).catch(() => {
                alert('❌ Copy failed. Please try the CSV export instead.');
            });
        }

        // PDF Report Generation
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get current date for report
            const reportDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Calculate metrics for summary
            const aircraftData = gatherAircraftData();
            const metrics = calculateReportMetrics(aircraftData);
            
            // Header
            doc.setFontSize(20);
            doc.setTextColor(30, 60, 114); // Dark blue
            doc.text('Aircraft Production Report', 20, 25);
            
            doc.setFontSize(12);
            doc.setTextColor(102, 117, 127); // Gray
            doc.text(`Generated on ${reportDate}`, 20, 35);
            
            // Executive Summary
            let yPosition = 50;
            doc.setFontSize(16);
            doc.setTextColor(73, 80, 87); // Dark gray
            doc.text('Executive Summary', 20, yPosition);
            
            yPosition += 15;
            doc.setFontSize(11);
            doc.setTextColor(33, 37, 41); // Black
            
            const summaryText = [
                `Total Aircraft in Production: ${metrics.totalAircraft}`,
                `Completed Aircraft: ${metrics.completedAircraft} (${metrics.completionRate}%)`,
                `Average Progress: ${metrics.avgProgress}%`,
                `Overdue Aircraft: ${metrics.overdueCount}`,
                `Critical Priority Items: ${metrics.criticalCount}`,
                `Most Active Team: ${metrics.mostActiveTeam}`
            ];
            
            summaryText.forEach(line => {
                doc.text(line, 25, yPosition);
                yPosition += 6;
            });
            
            // Status Breakdown Chart (text-based)
            yPosition += 10;
            doc.setFontSize(14);
            doc.setTextColor(73, 80, 87);
            doc.text('Status Breakdown', 20, yPosition);
            
            yPosition += 10;
            doc.setFontSize(10);
            const statusData = [
                ['Status', 'Count', 'Percentage'],
                ['Production Ready', metrics.statusCounts['Production Ready'].toString(), `${((metrics.statusCounts['Production Ready'] / metrics.totalAircraft) * 100).toFixed(1)}%`],
                ['In Progress', metrics.statusCounts['In Progress'].toString(), `${((metrics.statusCounts['In Progress'] / metrics.totalAircraft) * 100).toFixed(1)}%`],
                ['On Hold', metrics.statusCounts['On Hold'].toString(), `${((metrics.statusCounts['On Hold'] / metrics.totalAircraft) * 100).toFixed(1)}%`],
                ['Quality Check', metrics.statusCounts['Quality Check'].toString(), `${((metrics.statusCounts['Quality Check'] / metrics.totalAircraft) * 100).toFixed(1)}%`]
            ];
            
            doc.autoTable({
                head: [statusData[0]],
                body: statusData.slice(1),
                startY: yPosition,
                theme: 'grid',
                styles: { fontSize: 9 },
                headStyles: { fillColor: [30, 60, 114] },
                margin: { left: 20, right: 20 }
            });
            
            // New page for detailed aircraft information
            doc.addPage();
            yPosition = 25;
            
            doc.setFontSize(16);
            doc.setTextColor(73, 80, 87);
            doc.text('Aircraft Details & Operations Summary', 20, yPosition);
            
            yPosition += 15;
            
            // Create detailed table
            const tableData = [];
            aircraftData.forEach(aircraft => {
                const completedOps = aircraft.operations.filter(op => op).length;
                const totalOps = aircraft.operations.length;
                const progress = totalOps > 0 ? Math.round((completedOps / totalOps) * 100) : 0;
                
                const deliveryStatus = aircraft.deliveryDate ? 
                    (new Date(aircraft.deliveryDate) < new Date() && progress < 100 ? 'OVERDUE' : 'On Track') : 
                    'No Date Set';
                
                tableData.push([
                    aircraft.aircraftId || 'Unassigned',
                    aircraft.model || 'Not Selected',
                    aircraft.status || 'Unknown',
                    `${completedOps}/${totalOps}`,
                    `${progress}%`,
                    aircraft.priority || 'Medium',
                    aircraft.deliveryDate || 'TBD',
                    deliveryStatus,
                    aircraft.team || 'Unassigned'
                ]);
            });
            
            doc.autoTable({
                head: [['Aircraft ID', 'Model', 'Status', 'Operations', 'Progress', 'Priority', 'Delivery', 'Timeline', 'Team']],
                body: tableData,
                startY: yPosition,
                theme: 'striped',
                styles: { 
                    fontSize: 8,
                    cellPadding: 3
                },
                headStyles: { 
                    fillColor: [30, 60, 114],
                    fontSize: 9,
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { fontStyle: 'bold' }, // Aircraft ID
                    4: { halign: 'center' }, // Progress
                    7: { halign: 'center' }  // Timeline
                },
                didParseCell: function(data) {
                    // Color code overdue rows
                    if (data.cell.text[0] === 'OVERDUE') {
                        data.cell.styles.textColor = [220, 53, 69]; // Red
                        data.cell.styles.fontStyle = 'bold';
                    }
                    // Color code priorities
                    if (data.column.index === 5) { // Priority column
                        if (data.cell.text[0] === 'Critical') {
                            data.cell.styles.fillColor = [248, 215, 218]; // Light red
                            data.cell.styles.textColor = [114, 28, 36];
                        } else if (data.cell.text[0] === 'High') {
                            data.cell.styles.fillColor = [255, 243, 205]; // Light orange
                            data.cell.styles.textColor = [133, 100, 4];
                        }
                    }
                }
            });
            
            // Notes Summary Section
            const notesData = aircraftData.filter(aircraft => 
                aircraft.preFlightNotes || aircraft.preCertNotes || aircraft.ncmrNotes
            );
            
            if (notesData.length > 0) {
                doc.addPage();
                yPosition = 25;
                
                doc.setFontSize(16);
                doc.setTextColor(73, 80, 87);
                doc.text('Notes & Comments Summary', 20, yPosition);
                
                yPosition += 15;
                
                notesData.forEach(aircraft => {
                    if (yPosition > 250) { // Check if we need a new page
                        doc.addPage();
                        yPosition = 25;
                    }
                    
                    doc.setFontSize(12);
                    doc.setTextColor(30, 60, 114);
                    doc.text(`${aircraft.aircraftId || 'Unassigned'} - ${aircraft.model || 'Unknown Model'}`, 20, yPosition);
                    yPosition += 8;
                    
                    doc.setFontSize(9);
                    doc.setTextColor(33, 37, 41);
                    
                    if (aircraft.preFlightNotes) {
                        doc.text('Pre-Flight Notes:', 25, yPosition);
                        yPosition += 5;
                        const preFlightLines = doc.splitTextToSize(aircraft.preFlightNotes, 160);
                        doc.text(preFlightLines, 30, yPosition);
                        yPosition += preFlightLines.length * 4 + 3;
                    }
                    
                    if (aircraft.preCertNotes) {
                        doc.text('Pre-Certification Notes:', 25, yPosition);
                        yPosition += 5;
                        const preCertLines = doc.splitTextToSize(aircraft.preCertNotes, 160);
                        doc.text(preCertLines, 30, yPosition);
                        yPosition += preCertLines.length * 4 + 3;
                    }
                    
                    if (aircraft.ncmrNotes) {
                        doc.text('NCMR Notes:', 25, yPosition);
                        yPosition += 5;
                        const ncmrLines = doc.splitTextToSize(aircraft.ncmrNotes, 160);
                        doc.text(ncmrLines, 30, yPosition);
                        yPosition += ncmrLines.length * 4 + 3;
                    }
                    
                    yPosition += 8; // Space between aircraft
                });
            }
            
            // Footer on each page
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(102, 117, 127);
                doc.text(`Aircraft Production Dashboard - Page ${i} of ${pageCount}`, 20, 285);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 150, 285);
            }
            
            // Save the PDF
            const fileName = `Aircraft_Production_Report_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        function gatherAircraftData() {
            const rows = document.querySelectorAll('tbody tr:not(.hidden-row)');
            const aircraftData = [];
            
            rows.forEach(row => {
                const rowData = {
                    aircraftId: row.querySelectorAll('.table-input')[0]?.value || '',
                    model: row.querySelectorAll('.table-input')[1]?.value || '',
                    status: row.querySelector('.status-select')?.value || '',
                    operations: Array.from(row.querySelectorAll('.operation-checkbox')).map(cb => cb.checked),
                    priority: row.querySelector('.priority-select')?.value || '',
                    preFlightNotes: row.querySelectorAll('.notes-input')[0]?.value || '',
                    preCertNotes: row.querySelectorAll('.notes-input')[1]?.value || '',
                    ncmrNotes: row.querySelectorAll('.notes-input')[2]?.value || '',
                    deliveryDate: row.querySelector('input[type="date"]')?.value || '',
                    team: row.querySelectorAll('.table-input')[4]?.value || ''
                };
                aircraftData.push(rowData);
            });
            
            return aircraftData;
        }

        function calculateReportMetrics(aircraftData) {
            const metrics = {
                totalAircraft: aircraftData.length,
                completedAircraft: 0,
                avgProgress: 0,
                overdueCount: 0,
                criticalCount: 0,
                mostActiveTeam: 'None',
                statusCounts: {
                    'Production Ready': 0,
                    'In Progress': 0,
                    'On Hold': 0,
                    'Quality Check': 0
                }
            };
            
            let totalProgress = 0;
            const teamCounts = {};
            
            aircraftData.forEach(aircraft => {
                // Calculate progress
                const completedOps = aircraft.operations.filter(op => op).length;
                const totalOps = aircraft.operations.length;
                const progress = totalOps > 0 ? (completedOps / totalOps) : 0;
                totalProgress += progress;
                
                if (progress === 1) metrics.completedAircraft++;
                
                // Check overdue
                if (aircraft.deliveryDate) {
                    const deliveryDate = new Date(aircraft.deliveryDate);
                    const today = new Date();
                    if (deliveryDate < today && progress < 1) {
                        metrics.overdueCount++;
                    }
                }
                
                // Count priorities
                if (aircraft.priority === 'Critical') {
                    metrics.criticalCount++;
                }
                
                // Count statuses
                if (metrics.statusCounts.hasOwnProperty(aircraft.status)) {
                    metrics.statusCounts[aircraft.status]++;
                }
                
                // Count teams
                const team = aircraft.team || 'Unassigned';
                teamCounts[team] = (teamCounts[team] || 0) + 1;
            });
            
            // Calculate averages
            metrics.avgProgress = aircraftData.length > 0 ? 
                Math.round((totalProgress / aircraftData.length) * 100) : 0;
            metrics.completionRate = aircraftData.length > 0 ? 
                Math.round((metrics.completedAircraft / aircraftData.length) * 100) : 0;
            
            // Find most active team
            let maxCount = 0;
            for (const [team, count] of Object.entries(teamCounts)) {
                if (count > maxCount && team !== 'Unassigned') {
                    maxCount = count;
                    metrics.mostActiveTeam = team;
                }
            }
            
            return metrics;
        }

        // Selection functions
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all');
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');
            
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                const row = checkbox.closest('tr');
                if (checkbox.checked) {
                    row.classList.add('selected-row');
                } else {
                    row.classList.remove('selected-row');
                }
            });
            
            updateBulkControls();
        }

        function toggleRowSelection(checkbox) {
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                row.classList.add('selected-row');
            } else {
                row.classList.remove('selected-row');
            }
            
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            const selectAllCheckbox = document.getElementById('select-all');
            
            if (checkedBoxes.length === rowCheckboxes.length) {
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.checked = false;
            }
            
            updateBulkControls();
        }

        function updateBulkControls() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            const bulkButtons = document.querySelectorAll('.btn-purple');
            const selectedCount = document.getElementById('selected-count');
            
            selectedCount.textContent = selectedRows.length;
            
            if (selectedRows.length > 0) {
                bulkButtons.forEach(btn => btn.disabled = false);
            } else {
                bulkButtons.forEach(btn => btn.disabled = true);
            }
        }

        // Bulk operations
        function bulkUpdateStatus() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            const newStatus = prompt('Enter new status:\n- Production Ready\n- In Progress\n- On Hold\n- Quality Check');
            
            if (newStatus && ['Production Ready', 'In Progress', 'On Hold', 'Quality Check'].includes(newStatus)) {
                selectedRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const statusSelect = row.querySelector('.status-select');
                    statusSelect.value = newStatus;
                    updateStatusStyle(statusSelect);
                });
                
                updateSummaryCards();
                saveDataToStorage();
                alert(`Updated ${selectedRows.length} aircraft to "${newStatus}"`);
            }
        }

        function bulkUpdatePriority() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            const newPriority = prompt('Enter new priority:\n- Critical\n- High\n- Medium\n- Low');
            
            if (newPriority && ['Critical', 'High', 'Medium', 'Low'].includes(newPriority)) {
                selectedRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const prioritySelect = row.querySelector('.priority-select');
                    prioritySelect.value = newPriority;
                    updatePriorityStyle(prioritySelect);
                });
                
                saveDataToStorage();
                alert(`Updated ${selectedRows.length} aircraft to "${newPriority}" priority`);
            }
        }

        function bulkUpdateTeam() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            const newTeam = prompt('Enter team name:');
            
            if (newTeam) {
                selectedRows.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    const teamInput = row.querySelectorAll('.table-input')[4]; // Team input is last
                    teamInput.value = newTeam;
                });
                
                saveDataToStorage();
                alert(`Assigned ${selectedRows.length} aircraft to team "${newTeam}"`);
            }
        }

        function copySelectedAircraft() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            if (selectedRows.length === 0) return;
            
            const tbody = document.getElementById('aircraft-tbody');
            
            selectedRows.forEach(checkbox => {
                const originalRow = checkbox.closest('tr');
                const newRow = originalRow.cloneNode(true);
                
                // Clear aircraft ID
                const aircraftInput = newRow.querySelectorAll('.table-input')[0];
                aircraftInput.value = '';
                aircraftInput.placeholder = 'AC-00X (Copy)';
                
                // Uncheck all checkboxes
                const checkboxes = newRow.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                
                // Reset progress
                const progressFill = newRow.querySelector('.progress-fill');
                progressFill.style.width = '0%';
                
                // Clear date
                const dateInput = newRow.querySelector('input[type="date"]');
                dateInput.value = '';
                
                newRow.classList.remove('selected-row');
                tbody.appendChild(newRow);
                addEventListenersToRow(newRow);
                setupDragAndDrop(newRow);
            });
            
            updateSummaryCards();
            saveDataToStorage();
            alert(`Copied ${selectedRows.length} aircraft`);
        }

        // Style update functions
        function updateStatusStyle(selectElement) {
            if (!selectElement) return;
            
            selectElement.classList.remove('production-ready', 'in-progress', 'on-hold', 'quality-check');
            
            const value = selectElement.value;
            if (value === 'Production Ready') {
                selectElement.classList.add('production-ready');
            } else if (value === 'In Progress') {
                selectElement.classList.add('in-progress');
            } else if (value === 'On Hold') {
                selectElement.classList.add('on-hold');
            } else if (value === 'Quality Check') {
                selectElement.classList.add('quality-check');
            }
        }

        function updatePriorityStyle(selectElement) {
            if (!selectElement) return;
            
            selectElement.classList.remove('critical', 'high', 'medium', 'low');
            const value = selectElement.value.toLowerCase();
            selectElement.classList.add(value);
        }

        // Summary cards update
        function updateSummaryCards() {
            const statusCells = document.querySelectorAll('tbody tr:not(.hidden-row) .status-select');
            const counts = {
                'Production Ready': 0,
                'In Progress': 0,
                'On Hold': 0,
                'Quality Check': 0
            };
            
            statusCells.forEach(select => {
                const status = select.value;
                if (counts.hasOwnProperty(status)) {
                    counts[status]++;
                }
            });
            
            document.getElementById('prod-ready-count').textContent = counts['Production Ready'];
            document.getElementById('in-progress-count').textContent = counts['In Progress'];
            document.getElementById('on-hold-count').textContent = counts['On Hold'];
            document.getElementById('quality-check-count').textContent = counts['Quality Check'];
            document.getElementById('total-count').textContent = statusCells.length;
        }

        // Search and filter
        function searchAndFilter() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const teamFilter = document.getElementById('team-filter').value.toLowerCase();
            const priorityFilter = document.getElementById('priority-filter').value;
            
            const rows = document.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const aircraftInput = row.querySelectorAll('.table-input')[0];
                const modelSelect = row.querySelectorAll('.table-input')[1];
                const statusSelect = row.querySelector('.status-select');
                const prioritySelect = row.querySelector('.priority-select');
                const teamInput = row.querySelectorAll('.table-input')[4];
                
                if (!aircraftInput || !modelSelect || !statusSelect || !prioritySelect || !teamInput) return;
                
                const aircraftValue = aircraftInput.value.toLowerCase();
                const modelValue = modelSelect.value.toLowerCase();
                const statusValue = statusSelect.value;
                const priorityValue = prioritySelect.value;
                const teamValue = teamInput.value.toLowerCase();
                
                const matchesSearch = aircraftValue.includes(searchTerm) || modelValue.includes(searchTerm);
                const matchesStatus = !statusFilter || statusValue === statusFilter;
                const matchesTeam = !teamFilter || teamValue.includes(teamFilter);
                const matchesPriority = !priorityFilter || priorityValue === priorityFilter;
                
                if (matchesSearch && matchesStatus && matchesTeam && matchesPriority) {
                    row.classList.remove('hidden-row');
                } else {
                    row.classList.add('hidden-row');
                }
            });
            
            updateSummaryCards();
        }

        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('team-filter').value = '';
            document.getElementById('priority-filter').value = '';
            
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                row.classList.remove('hidden-row');
            });
            
            updateSummaryCards();
        }

        // Individual aircraft actions
        function deleteAircraft(button) {
            const row = button.closest('tr');
            const aircraftInput = row.querySelectorAll('.table-input')[0];
            const aircraftId = aircraftInput.value || 'this aircraft';
            
            if (confirm(`Are you sure you want to delete ${aircraftId}?`)) {
                row.remove();
                updateSummaryCards();
                updateBulkControls();
                saveDataToStorage();
            }
        }

        function duplicateAircraft(button) {
            const originalRow = button.closest('tr');
            const tbody = document.getElementById('aircraft-tbody');
            const newRow = originalRow.cloneNode(true);
            
            // Clear the aircraft ID and mark as copy
            const aircraftInput = newRow.querySelectorAll('.table-input')[0];
            aircraftInput.value = '';
            aircraftInput.placeholder = 'AC-00X (Copy)';
            
            // Uncheck all checkboxes
            const checkboxes = newRow.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            // Reset progress
            const progressFill = newRow.querySelector('.progress-fill');
            progressFill.style.width = '0%';
            
            // Clear date
            const dateInput = newRow.querySelector('input[type="date"]');
            dateInput.value = '';
            
            newRow.classList.remove('selected-row');
            tbody.appendChild(newRow);
            addEventListenersToRow(newRow);
            setupDragAndDrop(newRow);
            
            updateSummaryCards();
            saveDataToStorage();
            
            newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Add new aircraft
        function addNewAircraft() {
            const tbody = document.getElementById('aircraft-tbody');
            const newRow = document.createElement('tr');
            newRow.draggable = true;
            
            newRow.innerHTML = `
                <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                <td><input type="text" class="table-input" placeholder="AC-00X" /></td>
                <td>
                    <select class="table-input">
                        <option value="">Select Model</option>
                        <option value="PA-28-181">PA-28-181</option>
                        <option value="PA-28-181 DX">PA-28-181 DX</option>
                        <option value="PA-44-180">PA-44-180</option>
                        <option value="PA-46-350P">PA-46-350P</option>
                        <option value="PA-46-500">PA-46-500</option>
                        <option value="PA-46-700">PA-46-700</option>
                    </select>
                </td>
                <td>
                    <select class="status-select in-progress">
                        <option value="Production Ready">Production Ready</option>
                        <option value="In Progress" selected>In Progress</option>
                        <option value="On Hold">On Hold</option>
                        <option value="Quality Check">Quality Check</option>
                    </select>
                </td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" /></td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;"></div>
                    </div>
                </td>
                <td>
                    <select class="priority-select medium">
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </td>
                <td><textarea class="notes-input" placeholder="Enter pre-flight notes..."></textarea></td>
                <td><textarea class="notes-input" placeholder="Enter pre-cert notes..."></textarea></td>
                <td><textarea class="notes-input" placeholder="Enter NCMR notes..."></textarea></td>
                <td><input type="date" class="table-input" /></td>
                <td><input type="text" class="table-input" placeholder="Team Name" /></td>
                <td>
                    <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                    <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                </td>
            `;
            
            tbody.appendChild(newRow);
            addEventListenersToRow(newRow);
            setupDragAndDrop(newRow);
            updateSummaryCards();
            saveDataToStorage();
            
            newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Event listeners for rows
        function addEventListenersToRow(row) {
            // Checkbox
            const checkbox = row.querySelector('.row-checkbox');
            if (checkbox) {
                checkbox.addEventListener('change', function() {
                    toggleRowSelection(this);
                });
            }
            
            // Operation checkboxes
            const operationCheckboxes = row.querySelectorAll('.operation-checkbox');
            operationCheckboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    updateProgress(row);
                    saveDataToStorage();
                });
            });
            
            // Status select
            const statusSelect = row.querySelector('.status-select');
            if (statusSelect) {
                statusSelect.addEventListener('change', function() {
                    updateStatusStyle(this);
                    updateSummaryCards();
                    saveDataToStorage();
                });
            }
            
            // Priority select
            const prioritySelect = row.querySelector('.priority-select');
            if (prioritySelect) {
                prioritySelect.addEventListener('change', function() {
                    updatePriorityStyle(this);
                    saveDataToStorage();
                });
            }
            
            // All inputs
            const inputs = row.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', saveDataToStorage);
            });
            
            // Context menu
            row.addEventListener('contextmenu', function(e) {
                showContextMenu(e, this);
                return false;
            });
        }

        function updateProgress(row) {
            const checkboxes = row.querySelectorAll('.operation-checkbox');
            const checkedBoxes = row.querySelectorAll('.operation-checkbox:checked');
            const progressBar = row.querySelector('.progress-fill');
            
            if (checkboxes.length > 0) {
                const progressPercent = (checkedBoxes.length / checkboxes.length) * 100;
                progressBar.style.width = progressPercent + '%';
            }
        }

        // Local Storage Functions
        function saveDataToStorage() {
            const rows = document.querySelectorAll('tbody tr');
            const aircraftData = [];
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input, select, textarea');
                const rowData = {
                    aircraftId: row.querySelectorAll('.table-input')[0]?.value || '',
                    model: row.querySelectorAll('.table-input')[1]?.value || '',
                    status: row.querySelector('.status-select')?.value || 'In Progress',
                    operations: Array.from(row.querySelectorAll('.operation-checkbox')).map(cb => cb.checked),
                    priority: row.querySelector('.priority-select')?.value || 'Medium',
                    preFlightNotes: row.querySelectorAll('.notes-input')[0]?.value || '',
                    preCertNotes: row.querySelectorAll('.notes-input')[1]?.value || '',
                    ncmrNotes: row.querySelectorAll('.notes-input')[2]?.value || '',
                    deliveryDate: row.querySelector('input[type="date"]')?.value || '',
                    team: row.querySelectorAll('.table-input')[4]?.value || ''
                };
                aircraftData.push(rowData);
            });
            
            const dashboardData = {
                aircraft: aircraftData,
                lastSaved: new Date().toISOString(),
                version: '1.0'
            };
            
            try {
                localStorage.setItem('aircraftDashboardData', JSON.stringify(dashboardData));
                updateLastSavedTime();
            } catch (error) {
                console.error('Failed to save data:', error);
            }
        }

        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('aircraftDashboardData');
                if (!savedData) return false;
                
                const dashboardData = JSON.parse(savedData);
                const tbody = document.getElementById('aircraft-tbody');
                
                // Clear existing rows
                tbody.innerHTML = '';
                
                // Recreate rows from saved data
                dashboardData.aircraft.forEach(aircraftData => {
                    const newRow = createAircraftRow(aircraftData);
                    tbody.appendChild(newRow);
                    addEventListenersToRow(newRow);
                    setupDragAndDrop(newRow);
                });
                
                updateSummaryCards();
                updateLastSavedTime(dashboardData.lastSaved);
                
                return true;
            } catch (error) {
                console.error('Failed to load data:', error);
                return false;
            }
        }

        function createAircraftRow(data) {
            const newRow = document.createElement('tr');
            newRow.draggable = true;
            
            newRow.innerHTML = `
                <td><span class="drag-handle">⋮⋮</span><input type="checkbox" class="row-checkbox" /></td>
                <td><input type="text" class="table-input" value="${data.aircraftId}" /></td>
                <td>
                    <select class="table-input">
                        <option value="">Select Model</option>
                        <option value="PA-28-181" ${data.model === 'PA-28-181' ? 'selected' : ''}>PA-28-181</option>
                        <option value="PA-28-181 DX" ${data.model === 'PA-28-181 DX' ? 'selected' : ''}>PA-28-181 DX</option>
                        <option value="PA-44-180" ${data.model === 'PA-44-180' ? 'selected' : ''}>PA-44-180</option>
                        <option value="PA-46-350P" ${data.model === 'PA-46-350P' ? 'selected' : ''}>PA-46-350P</option>
                        <option value="PA-46-500" ${data.model === 'PA-46-500' ? 'selected' : ''}>PA-46-500</option>
                        <option value="PA-46-700" ${data.model === 'PA-46-700' ? 'selected' : ''}>PA-46-700</option>
                    </select>
                </td>
                <td>
                    <select class="status-select ${getStatusClass(data.status)}">
                        <option value="Production Ready" ${data.status === 'Production Ready' ? 'selected' : ''}>Production Ready</option>
                        <option value="In Progress" ${data.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="On Hold" ${data.status === 'On Hold' ? 'selected' : ''}>On Hold</option>
                        <option value="Quality Check" ${data.status === 'Quality Check' ? 'selected' : ''}>Quality Check</option>
                    </select>
                </td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" ${data.operations[0] ? 'checked' : ''} /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" ${data.operations[1] ? 'checked' : ''} /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" ${data.operations[2] ? 'checked' : ''} /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" ${data.operations[3] ? 'checked' : ''} /></td>
                <td class="operation-cell"><input type="checkbox" class="operation-checkbox" ${data.operations[4] ? 'checked' : ''} /></td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${calculateProgress(data.operations)}%;"></div>
                    </div>
                </td>
                <td>
                    <select class="priority-select ${data.priority.toLowerCase()}">
                        <option value="Critical" ${data.priority === 'Critical' ? 'selected' : ''}>Critical</option>
                        <option value="High" ${data.priority === 'High' ? 'selected' : ''}>High</option>
                        <option value="Medium" ${data.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                        <option value="Low" ${data.priority === 'Low' ? 'selected' : ''}>Low</option>
                    </select>
                </td>
                <td><textarea class="notes-input" placeholder="Enter pre-flight notes...">${data.preFlightNotes}</textarea></td>
                <td><textarea class="notes-input" placeholder="Enter pre-cert notes...">${data.preCertNotes}</textarea></td>
                <td><textarea class="notes-input" placeholder="Enter NCMR notes...">${data.ncmrNotes}</textarea></td>
                <td><input type="date" class="table-input" value="${data.deliveryDate}" /></td>
                <td><input type="text" class="table-input" value="${data.team}" placeholder="Team Name" /></td>
                <td>
                    <button class="btn-small btn-danger" onclick="deleteAircraft(this)" title="Delete Aircraft">🗑️</button>
                    <button class="btn-small" onclick="duplicateAircraft(this)" title="Duplicate Aircraft">📋</button>
                </td>
            `;
            
            return newRow;
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Production Ready': return 'production-ready';
                case 'In Progress': return 'in-progress';
                case 'On Hold': return 'on-hold';
                case 'Quality Check': return 'quality-check';
                default: return 'in-progress';
            }
        }

        function calculateProgress(operations) {
            const checked = operations.filter(op => op).length;
            return operations.length > 0 ? (checked / operations.length) * 100 : 0;
        }

        function updateLastSavedTime(timestamp = null) {
            const lastUpdatedElement = document.getElementById('last-updated');
            if (lastUpdatedElement) {
                const time = timestamp ? new Date(timestamp) : new Date();
                lastUpdatedElement.textContent = `Dashboard Last Saved: ${time.toLocaleDateString()} at ${time.toLocaleTimeString()}`;
            }
        }

        // Data management functions
        function clearAllData() {
            if (confirm('Are you sure you want to clear all aircraft data? This action cannot be undone.')) {
                localStorage.removeItem('aircraftDashboardData');
                location.reload();
            }
        }

        function exportBackup() {
            const savedData = localStorage.getItem('aircraftDashboardData');
            if (!savedData) {
                alert('No data to export');
                return;
            }
            
            const blob = new Blob([savedData], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aircraft_dashboard_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function importBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            localStorage.setItem('aircraftDashboardData', JSON.stringify(importedData));
                            location.reload();
                        } catch (error) {
                            alert('Invalid backup file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ============================================================================
        // QUICK ACTION TOOLBAR FUNCTIONALITY
        // ============================================================================

        // Keyboard Shortcuts Handler
        function handleKeyboardShortcuts(event) {
            // Don't trigger shortcuts when typing in input fields
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'SELECT') {
                return;
            }
            
            if (event.ctrlKey && event.key === 'a') {
                event.preventDefault();
                selectAllRows();
            } else if (event.key === 'Delete') {
                event.preventDefault();
                if (document.querySelectorAll('.row-checkbox:checked').length > 0) {
                    bulkDeleteSelected();
                }
            } else if (event.ctrlKey && event.key === 'n') {
                event.preventDefault();
                addNewAircraft();
            } else if (event.key === 'Escape') {
                event.preventDefault();
                clearAllSelections();
                hideContextMenu();
                hideShortcutsHelp();
            } else if (event.key === 'F1') {
                event.preventDefault();
                toggleShortcutsHelp();
            }
        }

        // Context Menu Functions
        function showContextMenu(event, row) {
            event.preventDefault();
            currentContextRow = row;
            
            const contextMenu = document.getElementById('context-menu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            
            // Ensure menu doesn't go off screen
            const rect = contextMenu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                contextMenu.style.left = (event.pageX - rect.width) + 'px';
            }
            if (rect.bottom > window.innerHeight) {
                contextMenu.style.top = (event.pageY - rect.height) + 'px';
            }
        }

        function hideContextMenu() {
            document.getElementById('context-menu').style.display = 'none';
            currentContextRow = null;
        }

        // Context Menu Actions
        function contextEditAircraft() {
            if (!currentContextRow) return;
            
            const aircraftInput = currentContextRow.querySelectorAll('.table-input')[0];
            aircraftInput.focus();
            aircraftInput.select();
            hideContextMenu();
        }

        function contextCopyAircraft() {
            if (!currentContextRow) return;
            
            const tbody = document.getElementById('aircraft-tbody');
            const newRow = currentContextRow.cloneNode(true);
            
            // Clear the aircraft ID
            const aircraftInput = newRow.querySelectorAll('.table-input')[0];
            aircraftInput.value = '';
            aircraftInput.placeholder = 'AC-00X (Copy)';
            
            // Uncheck all checkboxes
            const checkboxes = newRow.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            // Reset progress
            const progressFill = newRow.querySelector('.progress-fill');
            progressFill.style.width = '0%';
            
            // Clear date
            const dateInput = newRow.querySelector('input[type="date"]');
            dateInput.value = '';
            
            newRow.classList.remove('selected-row');
            tbody.appendChild(newRow);
            addEventListenersToRow(newRow);
            setupDragAndDrop(newRow);
            
            updateSummaryCards();
            saveDataToStorage();
            hideContextMenu();
            
            newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function contextChangeStatus() {
            if (!currentContextRow) return;
            
            const statusSelect = currentContextRow.querySelector('.status-select');
            const newStatus = prompt('Enter new status:\n- Production Ready\n- In Progress\n- On Hold\n- Quality Check');
            
            if (newStatus && ['Production Ready', 'In Progress', 'On Hold', 'Quality Check'].includes(newStatus)) {
                statusSelect.value = newStatus;
                updateStatusStyle(statusSelect);
                updateSummaryCards();
                saveDataToStorage();
            }
            hideContextMenu();
        }

        function contextChangePriority() {
            if (!currentContextRow) return;
            
            const prioritySelect = currentContextRow.querySelector('.priority-select');
            const newPriority = prompt('Enter new priority:\n- Critical\n- High\n- Medium\n- Low');
            
            if (newPriority && ['Critical', 'High', 'Medium', 'Low'].includes(newPriority)) {
                prioritySelect.value = newPriority;
                updatePriorityStyle(prioritySelect);
                saveDataToStorage();
            }
            hideContextMenu();
        }

        function contextSelectRow() {
            if (!currentContextRow) return;
            
            const checkbox = currentContextRow.querySelector('.row-checkbox');
            checkbox.checked = !checkbox.checked;
            toggleRowSelection(checkbox);
            hideContextMenu();
        }

        function contextDeleteAircraft() {
            if (!currentContextRow) return;
            
            const aircraftId = currentContextRow.querySelectorAll('.table-input')[0].value || 'this aircraft';
            if (confirm(`Are you sure you want to delete ${aircraftId}?`)) {
                currentContextRow.remove();
                updateSummaryCards();
                updateBulkControls();
                saveDataToStorage();
            }
            hideContextMenu();
        }

        // Keyboard Shortcut Helper Functions
        function selectAllRows() {
            const selectAllCheckbox = document.getElementById('select-all');
            selectAllCheckbox.checked = true;
            toggleSelectAll();
        }

        function clearAllSelections() {
            const selectAllCheckbox = document.getElementById('select-all');
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');
            
            selectAllCheckbox.checked = false;
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
                const row = checkbox.closest('tr');
                row.classList.remove('selected-row');
            });
            
            updateBulkControls();
        }

        function bulkDeleteSelected() {
            const selectedRows = document.querySelectorAll('.row-checkbox:checked');
            if (selectedRows.length === 0) return;
            
            if (confirm(`Are you sure you want to delete ${selectedRows.length} aircraft?`)) {
                selectedRows.forEach(checkbox => {
                    checkbox.closest('tr').remove();
                });
                
                updateSummaryCards();
                updateBulkControls();
                saveDataToStorage();
            }
        }

        function toggleShortcutsHelp() {
            const help = document.getElementById('shortcuts-help');
            help.style.display = help.style.display === 'block' ? 'none' : 'block';
        }

        function hideShortcutsHelp() {
            document.getElementById('shortcuts-help').style.display = 'none';
        }

        // Drag and Drop Functions
        function setupDragAndDrop(row) {
            row.addEventListener('dragstart', handleDragStart);
            row.addEventListener('dragover', handleDragOver);
            row.addEventListener('drop', handleDrop);
            row.addEventListener('dragend', handleDragEnd);
            row.addEventListener('dragenter', handleDragEnter);
            row.addEventListener('dragleave', handleDragLeave);
        }

        function handleDragStart(e) {
            draggedRow = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
            
            // Change cursor to grabbing for drag handle
            const dragHandle = this.querySelector('.drag-handle');
            if (dragHandle) {
                dragHandle.style.cursor = 'grabbing';
            }
        }

        function handleDragEnter(e) {
            if (draggedRow !== this) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedRow !== this) {
                const tbody = this.parentNode;
                const draggedIndex = Array.from(tbody.children).indexOf(draggedRow);
                const targetIndex = Array.from(tbody.children).indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    tbody.insertBefore(draggedRow, this.nextSibling);
                } else {
                    tbody.insertBefore(draggedRow, this);
                }
                
                saveDataToStorage();
                
                // Show success feedback
                this.style.backgroundColor = '#d4edda';
                setTimeout(() => {
                    this.style.backgroundColor = '';
                }, 1000);
            }
            
            return false;
        }

        function handleDragEnd(e) {
            // Clean up all visual feedback
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                row.classList.remove('dragging', 'drag-over');
                const dragHandle = row.querySelector('.drag-handle');
                if (dragHandle) {
                    dragHandle.style.cursor = 'grab';
                }
            });
            
            draggedRow = null;
        }
    </script>
</body>
</html>
